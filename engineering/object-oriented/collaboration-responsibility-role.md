# 역할, 책임, 협력(조영호 저 Object 3장)

객체 지향의 본질은 협력하는 객체들의 공동체를 창조하는 것이다.

객체지향 설계의 핵심은 협력을 구성하기 위해 적절한 객체를 찾고 적절한 책임을 할당하는 과정이다.

## 협력

두 객체 사이의 협력은 하나의 객체가 다른 객체에게 도움을 요청할 때 시작된다.

메시지 전송(message sending)은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다.

객체는 다른 객체의 상세한 구현에 직접 접근할 수 없기 때문에 오직 메시지 전송을 통해서만 자신의 요청을 전달할 수 있다.

```
협력이란 어떤 객체가 다른 객체에게 무엇인가를 요청하는 것이다. 한 객체는 어떤 것이 필요할 때 다른 객체에게 전적으로 위임하거나 서로 협력한다. 즉, 두 객체가 상호작용을 통해 더 큰 책임을 수행하는 것이다. 객체 사이의 협력을 설계할 때는 객체를 서로 분리된 인스턴스가 아닌 협력하는 파트너로 인식해야 한다.
```

메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다. 여기서 객체가 메시지를 처리할 방법을 스스로 선택한다는 점이 중요하다.

자신이 할 수 없는 일을 다른 객체에게 위임하면 협력에 참여하는 객체들의 전체적인 자율성을 향상시킬 수 있다.

결과적으로 객체를 자율적으로 만드는 가장 기본적인 방법은 내부 구현을 캡슐화하는 것이다.

자율적인 객체는 변경에 대한 파급효과를 제한할 수 있기 때문에 객체를 변경하기도 쉬워진다.

### 협력이 설계를 위한 문맥을 결정한다.

객체지향은 객체를 중심에 놓는 프로그래밍 패러다임이다. 여기서 객체란 상태와 행동을 함께 캡슐화하는 실행단위다.

협력은 객체가 필요한 이유와 동기를 제공한다.

Movie 라는 객체가 있을 때 자연스럽게 play라는 행동을 수행할 것이라고 생각할 수 있다.

하지만, 예매 시스템 안의 Movie는 영상을 상영하기 위한 코드는 포함돼있지 않다.

Movie의 행동을 결정하는 것은 영화 예매를 위한 시스템 내에서 어떤 책임을 가져가고 어떻게 협력할지 이다.

객체의 행동을 결정하는 것은 영화 예매를 위한 협력이다.

객체의 상태는 그 객체가 행동을 수행하는 데 필요한 정보가 무엇인지로 결정된다.

Movie가 기본 요금인 fee와 할인 정책인 discountPolicy라는 인스턴스 변수를 상태의 일부로 포함하는 이유는 요금 계산이라는 행동을 수행하는데 이 정보들이 필요하기 때문이다.

```java
public class Movie {
  private Money fee;
  private DiscountPolicy discountPolicy;

  public Money calculateMovieFee(Screening screening){
    return fee.minus(discountPolicy.calculateDiscountAmount(screening));
  }
}
```

## 책임

책임은 협력에 참여하기 위해 객체가 수행하는 행동이다.

책임은 두 가지로 분류할 수 있다.

1. 하는 것
   - 객체를 생성하거나 계산을 스스로 수행 하는 것
   - 다른 객체의 행동을 시작시키는 것
   - 다른 객체의 활동을 제어하고 조절하는 것
2. 아는 것(권한)
   - 사적인 정보에 관해 하는 것
   - 관련된 객체에 대해 하는 것
   - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

일반적으로 책임과 메시지의 크기는 다르다.

책임은 객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술하기 때문에 메시지보다 추상적이고 개념적으로도 더 크다. 처음에 단순한 책임리가ㅗ 생각했던 것이 여러 개의 메시지로 분할되기도 하고 하나의 객체가 수행할 수 있다고 생각했던 책임이 나중에는 여러 객체들이 협력해야만 하는 커다란 책임으로 자라나는 것이 일반적이다.

여기서 중요한 것은 `아는 것` 과 `하는 것`이 밀접하게 연관돼 있다는 것이다.

- 객체는 책임을 수행하는데 필요한 정보를 알거나
- 자신이 할 수 없는 작업을 도와줄 객체를 알고 있을 책임이 있다.

### 책임 할당

자율적인 객체를 만드는 가장 기본적인 방법은 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것이다. 이를 Information Export(정보 전문가) 패턴이라고 부른다.

객체들 역시 협력에 필요한 지식과 방법을 가장 잘 알고 있는 객체에게 도움을 요청한다.

따라서 객체에 책임을 할당하기 위해서는 협력이라는 문맥을 먼저 정의해야 한다. 협력을 설계하는 출발점은 사용자에게 제공해야하는 기능을 시스템이 담당할 하나의 책임으로 바라보는 것이다.

영화 예매 시스템을 예로 들어 정보 전문가에게 책임을 할당하는 법을 살펴보자.

1. 영화 예매 시스템이 재공해야하는 기능을 메시지로 정의한다. `예매하라`
2. 영화의 상영시간과 기본 요금을 알고 있는 정보 책임자 Screening에게 `영화 예매` 책임을 할당한다.
3. 영화 예매를 수행하기 위해서는 예매 가격을 계산해야 한다. 외부 객체에게 `영화 가격 계산하라`를 요청해야한다.
4. 영화 가격을 계산하기 위한 정보를 가장 잘 알 고 있는 Movie에게 `가격 계산` 책임을 할당한다.

이 과정을 반복하여 설계가 이루어진다.

모든 책임 할당 과정이 이렇게 단순하지는 않다. 어떤 경우에는 결합도 관점에서 정보 전문가가 아닌 다른 객체에게 책임을 할당하는 것이 더 적절한 경우도 있다.

### 책임 주도 설계

책임 주도 설계 방법의 과정은 다음과 같다.

- 시스템이 사용자에게 제공해야하는 기능인 시스템의 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

### 메시지가 객체를 결정한다.

중요한 것은 책임을 할당하는 데 필요한 메시지를 먼저 식별하고 이를 처리할 객체를 나중에 선택하는 것이다. 여기에는 두 가지 이유가 있다.

1. 객체가 최소한의 인터페이스를 가질 수 있게된다.
2. 객체가 추상적인 인터페이스를 가질 수 있게된다.

### 행동이 상태를 결정한다.

객체가 존재하는 이유는 협력에 참여하기 위해서이다. 때문에 객체의 상태가 아닌 행동에 초점을 맞춰야 한다.

## 역할

### 역할과 협력

객체가 어떤 특정한 협력 안에서 맡게되는 책임의 집합을 역할이라고 한다.

예를 들며, 영화 예매에서 `예매하라`라는 메시지를 처리를 Screening이 하도록 선택했다. 이 과정은 두 개의 단계로 나눌 수 있다.

1. 영화를 예매할 수 있는 적절한 역할이 무엇인가를 찾는 것
2. 역할을 수행할 객체로 Screening 인스턴스를 선택

왜 이런 역할을 찾는 과정을 정의할까?

### 유연하고 재사용 가능한 협력

역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있다. Movie 객체가 AmountDiscountPolicy와 PercentDiscountPolicy에 각각 개별적인 메시지를 보낸다고하면 중복코드가 발생한다. 두 DiscountPolicy 객체는 결국 할인 요금 계산이라는 동일한 책임을 수행한다는 것을 알 수 있다. 이렇게 책임을 포괄할 수 있도록 추상화한 것이 역할이다.

### 객체 대 역할

책임을 수행하는 대상이 한 종류라면 객체, 여러 종류의 객체가 책임을 수행할 수 있으면 역할이라고 부를 수 있다.
